<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="custom_trance_service_area">

	<select id="queryByUserIdAndNowDateTimeCount" parameterType="java.util.Map" resultType="java.lang.Long">
		SELECT
			COUNT(1)
		FROM
			dd_surveyor dsr,ct_person_service cps
		WHERE dsr.ct_user_id = cps.user_id
			AND cps.service_id = '1'
			AND dsr.ct_user_id = #{ctUserId}
			AND (
				(dsr.user_type='1' AND substring(cps.city_code,1,4) = substring(#{areaCode},1,4))<!-- 协调人精确到市 -->
				OR
				(dsr.user_type='2' AND substring(cps.city_code,1,2) = substring(#{areaCode},1,2))<!-- 受阻人精确到省 -->
			)
	</select>
	
	<select id="queryByUserIdAndNowDateTime" parameterType="net.chetong.order.model.DdTranceServiceArea" resultType="net.chetong.order.model.DdTranceServiceArea">
		SELECT
			dsr.id as id,
			cps.prov_code as provCode,
			cps.city_code as cityCode,
			cps.area_code as areaCode,
			dsr.ct_user_id as ctUserId,
			dsr.user_type as userType,
			dsr.subject_type as subject_type
		FROM
			dd_surveyor dsr,ct_person_service cps
		WHERE dsr.ct_user_id = cps.user_id
			AND dsr.ct_user_id = #{ctUserId}
			AND dsr.user_type = #{userType}
	</select>
</mapper>